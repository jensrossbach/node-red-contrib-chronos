<!--
Copyright (c) 2024 Jens-Uwe Rossbach

This code is licensed under the MIT License.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->

<script type="text/html" data-help-name="chronos-change">
    <p>
        Sets or changes time values from message properties, flow variables or
        global variables.
    </p>
    <h3>Details</h3>
    <p>
        This node sets message properties, flow variables or global variables
        to specific times or manipulates and converts timestamps from these
        input fields. Multiple actions can be configured per node which will be
        executed in the specified order. It is also possible to chain different
        actions for the same property or variable.
    </p>
    <p>
        For more information, please refer to the detailed documentation in the
        <a href="https://github.com/jensrossbach/node-red-contrib-chronos/wiki/Time-Change-Node">repository wiki</a>.
    </p>
    <h3>Configuration</h3>
    <dl>
        <dt>Name</dt>
        <dd>The name of the node (optional).</dd>
        <dt>Configuration</dt>
        <dd>
            A reference to the configuration node to be used.
        </dd>
        <dt>Change Rules</dt>
        <dd>
            <p>
                The list containing the rules for setting or changing target
                values. New entries can be added using the button below the
                list. Existing entries can be reordered or deleted. The following
                actions can be selected:
                <ul>
                    <li>
                        <i>Set</i>: Sets the selected target to a specific date
                        and time.
                    </li>
                    <li>
                        <i>Change</i>: Modifies the timestamp value of the
                        selected target according to the configured manipulation
                        and conversion rules. The original target value can be
                        either a number containing the milliseconds elapsed since
                        the UNIX epoch or a string containing a date and time
                        which must be parsable according to
                        <a href="https://momentjs.com/docs/#/parsing/string/">Moment.js documentation</a>.
                    </li>
                </ul>
            </p>
            <p>
                To the right of the rule action, the target to set or change
                can be selected. This can be either a message property, a flow
                variable or a global variable.
            </p>
            <p>
                For the set action, the following possibilities can be selected:
                <ul>
                    <li>
                        <i>current time</i>: Sets the target to the current time
                        of the current day.
                    </li>
                    <li>
                        <i>date and time</i>: Sets the target to a specific date
                        and time. See below for more details.
                    </li>
                    <li>
                        <i>expression</i>: Sets the target to the result of the
                        provided JSONata expression. Additional time calculation
                        functions are supported and the current target value can
                        be accessed through variable <code>$target</code>.
                    </li>
                </ul>
                For the date and time input, the date has to be entered in the
                form <code>YYYY-MM-DD</code> and the time can be provided in the
                following ways:
                <ul>
                    <li>
                        <i>time of day</i>: A specific time can be entered
                        directly in the form <code>hh:mm[:ss] [am|pm]</code>.
                    </li>
                    <li>
                        <i>sun position</i>: The sun position can be selected
                        from a list of predefined values.
                    </li>
                    <li>
                        <i>moon position</i>: The moon position can be selected
                        from a list of predefined values.
                    </li>
                    <li>
                        <i>custom sun position</i>: One of the user-defined sun position
                        names can be entered.
                    </li>
                </ul>
            </p>
            <p>
                For the change action, different types of manipulation and
                conversion can be selected:
                <ul>
                    <li>
                        <i>Set</i>: Modifies a part of the target timestamp.
                        The part to be changed can be selected in the dropdown
                        box.
                    </li>
                    <li>
                        <i>Add</i>: Adds time to the target timestamp. The amount
                        of time has to entered as number and the unit of time
                        to be added can be selected in the dropdown box.
                    </li>
                    <li>
                        <i>Subtract</i>: Similar to <i>Add</i>, but subtracts
                        time from the target timestamp.
                    </li>
                    <li>
                        <i>Start of</i>: Sets the target timestamp to the start
                        of a unit of time. The latter can be selected in the
                        dropdown box.
                    </li>
                    <li>
                        <i>End of</i>: Similar to <i>Start of</i>, but sets the
                        target timestamp to the end of a unit of time.
                    </li>
                    <li>
                        <i>Convert</i>: Converts the target timestamp to
                        different kind of string representations:
                        <ul>
                            <li>
                                <i>predefined format</i>: String format can be
                                chosen from a list of predefined formats.
                            </li>
                            <ul>
                                <li>
                                    <i>regional</i>: String containing the date
                                    and the time in a region-specific format.
                                </li>
                                <li>
                                    <i>regional (date only)</i>: String containing
                                    the date in a region-specific format.
                                </li>
                                <li>
                                    <i>regional (time only)</i>: String containing
                                    the time in a region-specific format.
                                </li>
                                <li>
                                    <i>relative time</i>: String representing the time
                                    relative to the current time, being less precise
                                    the farer away it is.
                                </li>
                                <li>
                                    <i>calendar</i>: String containing the absolute
                                    time (if not farer away than one week) and the
                                    date relative to today (or absolute if farer away
                                    than one week).
                                </li>
                                <li>
                                    <i>ISO-8601</i>: ISO-8601 string as local time
                                    (according to configured time zone).
                                </li>
                                <li>
                                    <i>ISO-8601 (UTC)</i>: ISO-8601 string as UTC
                                    time.
                                </li>
                            </ul>
                            <li>
                                <i>custom format</i>: String can be customized
                                by specifying the format via the text box which
                                must follow the rules from the <a href="https://momentjs.com/docs/#/displaying/format/">Moment.js documentation</a>.
                            </li>
                        </ul>
                        In the second row, it is possible to change the local time
                        of the input timestamp:
                        <ul>
                            <li>
                                <i>current time zone</i>: The original time zone (the
                                time zone configured in the associated configuration
                                node) is kept unmodified.
                            </li>
                            <li>
                                <i>time zone</i>: The name of a valid <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">time zone identifier</a>
                                can be specified and the time is converted to that
                                time zone.
                            </li>
                            <li>
                                <i>UTC offset</i>: An offset in minutes and/or hours
                                can be specified. A number between -16 and 16 is
                                interpreted as hours, a number outside of that range
                                as minutes. Additionally, it is possible to specify
                                hours and minutes in the form <code>+/-HH:MM</code>.
                                The value is applied as offset to the UTC time.
                            </li>
                        </ul>
                    </li>
                </ul>
            </p>
        </dd>
    </dl>
    <h3>Input</h3>
    <p>
        Incoming messages are modified if there are change rules containing
        message property based targets.
    </p>
    <h3>Outputs</h3>
    <p>
        The output port forwards any incoming message.
    </p>
</script>
